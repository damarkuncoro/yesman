### YesMan API Quick Test
### File ini berisi test cases yang paling sering digunakan

# Variables - Update sesuai kebutuhan
@baseUrl = http://localhost:3000
@adminEmail = admin@yesman.com
@adminPassword = admin123
@testEmail = test@yesman.com
@testPassword = test123

###############################################
# QUICK START - AUTHENTICATION FLOW
###############################################

### 1. Health Check - Pastikan server berjalan
GET {{baseUrl}}/api/health

### 2. Login Admin - Dapatkan token untuk testing
# @name loginAdmin
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### 3. Get Profile - Test token yang didapat
GET {{baseUrl}}/api/v1/users/profile
Authorization: Bearer {{loginAdmin.response.body.data.token}}

###############################################
# USER MANAGEMENT FLOW
###############################################

### 4. Register New Test User
# @name registerUser
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}",
  "name": "Test User",
  "department": "IT",
  "region": "Jakarta"
}

### 5. Login Test User
# @name loginTestUser
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

### 6. Get All Users (Admin Only)
GET {{baseUrl}}/api/v1/users
Authorization: Bearer {{loginAdmin.response.body.data.token}}

###############################################
# RBAC TESTING
###############################################

### 7. Get All Roles
GET {{baseUrl}}/api/v1/rbac/roles
Authorization: Bearer {{loginAdmin.response.body.data.token}}

### 8. Create Test Role
# @name createRole
POST {{baseUrl}}/api/v1/rbac/roles
Authorization: Bearer {{loginAdmin.response.body.data.token}}
Content-Type: application/json

{
  "name": "Test Manager",
  "description": "Role untuk testing manager",
  "is_active": true
}

### 9. Get All Features
GET {{baseUrl}}/api/v1/rbac/features
Authorization: Bearer {{loginAdmin.response.body.data.token}}

### 10. Create Test Feature
# @name createFeature
POST {{baseUrl}}/api/v1/rbac/features
Authorization: Bearer {{loginAdmin.response.body.data.token}}
Content-Type: application/json

{
  "name": "test_management",
  "description": "Feature untuk testing management",
  "is_active": true
}

###############################################
# DASHBOARD & STATISTICS
###############################################

### 11. Get Dashboard Stats
GET {{baseUrl}}/api/v1/dashboard/stats
Authorization: Bearer {{loginAdmin.response.body.data.token}}

### 12. Get User Statistics
GET {{baseUrl}}/api/v1/dashboard/user-stats
Authorization: Bearer {{loginAdmin.response.body.data.token}}

### 13. Get Access Statistics
GET {{baseUrl}}/api/v1/dashboard/access-stats
Authorization: Bearer {{loginAdmin.response.body.data.token}}

###############################################
# AUDIT LOGS
###############################################

### 14. Get Recent Access Logs
GET {{baseUrl}}/api/v1/audit/access-logs?limit=5
Authorization: Bearer {{loginAdmin.response.body.data.token}}

### 15. Get Session Logs
GET {{baseUrl}}/api/v1/audit/session-logs?limit=5
Authorization: Bearer {{loginAdmin.response.body.data.token}}

###############################################
# PERMISSION TESTING
###############################################

### 16. Test User Access (Should have limited access)
GET {{baseUrl}}/api/v1/rbac/roles
Authorization: Bearer {{loginTestUser.response.body.data.token}}

### 17. Test Admin Access (Should have full access)
GET {{baseUrl}}/api/v1/admin/system-health
Authorization: Bearer {{loginAdmin.response.body.data.token}}

###############################################
# ERROR SCENARIOS
###############################################

### 18. Test Invalid Login
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "invalid@email.com",
  "password": "wrongpassword"
}

### 19. Test Unauthorized Access
GET {{baseUrl}}/api/v1/users
# No Authorization header

### 20. Test Invalid Token
GET {{baseUrl}}/api/v1/users/profile
Authorization: Bearer invalid_token_123

###############################################
# CLEANUP (Optional)
###############################################

### 21. Logout Admin
POST {{baseUrl}}/api/v1/auth/logout
Authorization: Bearer {{loginAdmin.response.body.data.token}}

### 22. Logout Test User
POST {{baseUrl}}/api/v1/auth/logout
Authorization: Bearer {{loginTestUser.response.body.data.token}}